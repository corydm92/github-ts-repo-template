# Agent Workflow Guide

This document is the single source of truth for how agents should operate in this repo.
It is intentionally verbose and links to examples where possible.

## 1) Core Rules

- Follow trunk-based: short-lived branches -> PR into main -> release via tags/automation.
- CI runs on pull requests only (no push triggers).
- CD workflows are template-only unless explicitly copied into `.github/workflows`.
- Only one CD path should be active per project (Vercel OR Docker OR npm).
- Prefer deterministic workflows over manual steps.

## 2) Branching & PR Flow

### Standard flow

1. Create branch from `main`
2. Open PR into `main`
3. CI runs on PR
4. Merge to `main` after CI passes
5. Dev deploy runs (if CD path is installed and wired for trunk)

### Release flow

1. Run release automation workflow
2. Release commit + tag created on main
3. Prod deploy runs (tag-based)

References:

- `docs/process/__Initialization/3. Trunk-Based Runbook.md`
- `docs/process/__Initialization/2. Template Checklist.md`
- `docs/process/6. Feature Flags Policy.md`

## 3) CI/CD Behavior

- CI is PR-only.
- CD is branch/tag-driven once installed.

CD paths:

- Vercel: `cd-vercel-trunk-based.yml`
- Docker: `cd-docker-trunk-based.yml`
- npm: `cd-npm-trunk-based.yml`

Release automation:

- `release-automation.yml`

References:

- `docs/blueprint/Layer 05 - Build & Delivery/5.2 â€” CI CD with Docker Vercel and NPM ðŸš¦/Base Project Rules and Tooling/__Initialization/workflows/`
- `docs/blueprint/Layer 05 - Build & Delivery/5.2 â€” CI CD with Docker Vercel and NPM ðŸš¦/Supporting Atomic Notes/Release Automation Behavior.md`

## 4) Documentation Standards

- Use Jira-style tickets for work items.
- Prefer short, structured docs (Summary, Goals, Scope, Acceptance Criteria).
- Keep Blueprint changes aligned with actual workflows.
- If a section does not exist for the needed documentation, clone the **Section Example** for that layer and rename it to the new section.
- Be strict about section fit: check for an existing home first, and only add a new section when the topic does not belong elsewhere.

Examples:

- `.github/ISSUE_TEMPLATE/*.md`
- `docs/blueprint/Layer 05 - Build & Delivery/5.2 â€” CI CD with Docker Vercel and NPM ðŸš¦/Base Project Rules and Tooling/CI CD with Docker Vercel and NPM - Trunk-Based Deployment Flow.md`

## 5) Agent Expectations

- Ask once when blocked; otherwise proceed.
- Keep changes scoped and grouped into clean commits.
- Prefer deterministic automation over manual steps.
- If conflicting instructions exist, clarify before changing.

### Full PR Flow (Required)

1. If on `main`, create a new feature/bug branch before committing.
2. Review staged and unstaged changes; group related files into separate commits.
3. Use clear, conventional commit messages.
4. Push the branch.
5. Draft PR title + body + labels (ask once if details are missing).
6. Create PR against the correct base branch (default: `main`).

## 6) Troubleshooting

- CI failures: see `docs/process/7. CI CD Troubleshooting.md`
- Missing secrets: verify repo settings
- Tag not pushed: prod deploy will not trigger

## 7) Quick Links

- Trunk-Based Runbook: `docs/process/__Initialization/3. Trunk-Based Runbook.md`
- Feature Flags Policy: `docs/process/6. Feature Flags Policy.md`
- Template Checklist: `docs/process/__Initialization/2. Template Checklist.md`
- CI/CD Troubleshooting: `docs/process/7. CI CD Troubleshooting.md`
- Release Automation Behavior: `docs/blueprint/Layer 05 - Build & Delivery/5.2 â€” CI CD with Docker Vercel and NPM ðŸš¦/Supporting Atomic Notes/Release Automation Behavior.md`
